<!-- 上传图片组件 -->
<template id="cuplimage">
    <!--layerPage-->
    <block>
        <div class="am-form-group am-form-file">
            <div class="tpl-form-file-img" style="width:250px;">
                <img v-bind:src="value.file_path" v-if="value" style="max-width:100%; max-height:200px;" >
            </div>
            <button type="button" class="am-btn am-btn-danger am-btn-sm" v-if="!value">
                <i class="am-icon-cloud-upload"></i> 添加图片
            </button>
            <input id="doc-form-file" type="file" multiple="" @change="uplPic($event,name)">
        </div>
    </block>
</template>

<script>
    //定义hblock组件
    Vue.component('cuplimage', {
        //名称，值
        props: { name : String, value : Array },
        template: '#cuplimage',
        methods : {
            //上传图片
            uplPic : function ( e,name ){
                var that = this;
                var formData = new FormData();
                formData.append('file', $(e.target)[0].files[0]); // 文件数据
                if(!$(e.target)[0].files[0]){
                    return false;
                }
                $.ajax({
                    url: '{:config("xiesemi.picUplApiUrl")}',
                    type: 'POST',
                    cache: false,
                    data: formData,
                    processData: false,
                    contentType: false
                }).done(function(result) {
                    that.$emit('input', result.data);
                });
            }
        },
        created :function(){
            
        }
    });
</script>
